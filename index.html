<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Conteúdo das Aulas de Cerâmica – Buscador</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --ink:#0b0b0b; --muted:#2f2f2f; --line:#0b0b0b; --teal:#49d1d1; --card:#ffffff; --accent:#2563eb; --bg:#f4fbfb;
  }
  @media (prefers-color-scheme: dark){
    :root{ --ink:#f2f2f2; --muted:#bfbfbf; --line:#eaeaea; --teal:#2aa9a9; --card:#111; --bg:#0b0b0b; --accent:#7aa2ff; }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background: var(--bg); color: var(--ink); }

  .topbar{ background: var(--teal); padding: 18px 16px 10px; border-bottom: 4px solid var(--line); }
  .title{ font-size: clamp(24px, 4.5vw, 42px); font-weight: 900; letter-spacing:.5px; text-transform: uppercase; text-align:center; margin:0 0 8px 0; }

  .results-wrap{ max-width: 1100px; margin: 6px auto 0; }
  .results-head{ text-align:center; font-weight:900; font-size:20px; margin-bottom:6px; }
  .results-box{ background:#fff; min-height: 86px; border:3px solid #000; border-radius:12px; padding:10px 12px; }
  .results-content{ min-height:44px; line-height:1.35 }
  .results-meta{ display:flex; justify-content:space-between; align-items:center; margin-top:6px; font-size:13px; }
  .nav-arrows{ display:flex; gap:14px; justify-content:center; align-items:center; margin-top:8px; }
  .nav-btn{ width:44px; height:44px; border-radius:50%; display:grid; place-items:center; font-size:22px; font-weight:900; background:#fff; border:2px solid #000; cursor:pointer; }
  .counter{ font-weight:700 }

  .search-row{ display:grid; grid-template-columns: 1fr auto; gap:10px; max-width:1100px; margin:10px auto; align-items:center; }
  .search-input{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
  label{ font-weight:700 }
  input[type="text"]{ width:100%; border:2px solid #000; border-radius:999px; padding:10px 14px; font-size:18px; background:#fff; color:#000; }
  button#searchBtn{ cursor:pointer; border:2px solid #000; border-radius:999px; padding:10px 16px; font-weight:800; background:#fff; }

  .columns{ display:grid; grid-template-columns: 1fr 1fr 1fr; height: calc(100vh - 290px); max-width:1400px; margin:10px auto 20px;
            border-left:6px solid #000; border-right:6px solid #000; }
  .col{ display:flex; flex-direction:column; min-width:0; background:#fff; border-left:6px solid #000; }
  .col:first-child{ border-left:none }
  .col h2{ margin:0; padding:10px 12px; background:#cfcfcf; text-align:center; font-size:clamp(18px, 3vw, 34px); font-weight:900;
           text-transform:uppercase; border-bottom:4px solid #000; }
  .frame-wrap{ flex:1; overflow:hidden }
  iframe{ width:100%; height:100%; border:0; display:block; background:#fff; }

  .__hit-outline{ outline:3px solid #ffb100; background:#fff6c5; }
  mark{ background:#fff283; padding:0 .12em }
  .sr-only{ position:absolute; left:-9999px }
</style>
</head>
<body>
  <header class="topbar">
    <h1 class="title">CONTEÚDO DAS AULAS DE CERÂMICA</h1>

    <div class="results-wrap">
      <div class="results-head">RESULTADOS ENCONTRADOS</div>
      <div class="results-box" id="resultsBox">
        <div class="results-content" id="resultContent">
          <em style="opacity:.8">Faça uma busca abaixo. Navegue pelos resultados e clique no link para acessar.</em>
        </div>
        <div class="results-meta">
          <div id="resultSource"></div>
          <div class="counter" id="resultCounter"></div>
        </div>
        <div class="nav-arrows">
          <button class="nav-btn" id="prevBtn" title="Anterior" aria-label="Resultado anterior">◀</button>
          <button class="nav-btn" id="nextBtn" title="Próximo" aria-label="Próximo resultado">▶</button>
        </div>
      </div>
    </div>

    <div class="search-row">
      <div class="search-input">
        <label for="q">Buscar por palavra-chave</label>
        <form id="searchForm" style="display:contents">
          <input id="q" name="q" type="text" placeholder="Ex.: barbotina, fornecedor, torno..." required />
          <button id="searchBtn" type="submit">BUSCAR</button>
        </form>
      </div>
      <div class="sr-only" aria-live="polite" id="live"></div>
    </div>
  </header>

  <main class="columns" id="columns">
    <section class="col" id="col-ceramica">
      <h2>Aula de Cerâmica</h2>
      <div class="frame-wrap">
        <iframe id="frame-ceramica" src="" title="Aula de Cerâmica"></iframe>
      </div>
    </section>

    <section class="col" id="col-torno">
      <h2>Torno</h2>
      <div class="frame-wrap">
        <iframe id="frame-torno" src="" title="Torno"></iframe>
      </div>
    </section>

    <section class="col" id="col-esmalte">
      <h2>Esmalte</h2>
      <div class="frame-wrap">
        <iframe id="frame-esmalte" src="" title="Esmalte"></iframe>
      </div>
    </section>
  </main>

<script>
/* ========================== CONFIG DOS LINKS ========================== */
const CERAMICA_URL = "https://cesarabarbosa.github.io/auladeceramica";
const TORNO_URL    = "https://cesarabarbosa.github.io/torno";   // <— atualizado
const ESMALTE_URL  = "https://cesarabarbosa.github.io/esmalte";

const HOTMART_RE = /https?:\/\/hotmart\.com\/pt-br\/club\/aulasdeceramica\/community\/\d+\/post\/\d+/i;

/* =============================== HELPERS =============================== */
const $  = (s, r=document) => r.querySelector(s);
const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

function escapeHTML(str){
  return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function makeRegex(word){
  const esc = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  return new RegExp(esc, 'i');
}
function snippetAround(text, word, span=180){
  const re = makeRegex(word);
  const m = text.match(re);
  if(!m){ return escapeHTML(text.slice(0, span)) + (text.length>span?'…':''); }
  const i = m.index;
  const start = Math.max(0, i - Math.floor(span/2));
  const end = Math.min(text.length, i + word.length + Math.floor(span/2));
  const left = start>0 ? '…' : '';
  const right = end<text.length ? '…' : '';
  const before = escapeHTML(text.slice(start, i));
  const hit = `<mark>${escapeHTML(text.slice(i, i+word.length))}</mark>`;
  const after = escapeHTML(text.slice(i+word.length, end));
  return left + before + hit + after + right;
}

/* ========================= IFRAMES ========================= */
const frames = {
  ceramica: { el: $('#frame-ceramica'), url: CERAMICA_URL, name: 'Aula de Cerâmica' },
  torno:    { el: $('#frame-torno'),    url: TORNO_URL,    name: 'Torno' },
  esmalte:  { el: $('#frame-esmalte'),  url: ESMALTE_URL,  name: 'Esmalte' },
};

const framesReady = Promise.all(Object.values(frames).map(f => new Promise(res=>{
  f.el.addEventListener('load', ()=>{
    try{
      const doc = f.el.contentDocument;
      f.doc = doc;
      const style = doc.createElement('style');
      style.textContent = ".__hit-outline{outline:3px solid #ffb100; background:#fff6c5;}";
      doc.head.appendChild(style);
    }catch(e){}
    res();
  }, {once:true});
  f.el.src = f.url;
})));

/* ========================= BUSCA ========================= */
let hits = [];
let hitIndex = -1;

async function runSearch(word){
  $('#live').textContent = '';
  hits = [];
  hitIndex = -1;

  await framesReady;

  const q = word.trim();
  if(!q){ showMessage("Digite uma palavra para buscar."); return; }

  const reWord = makeRegex(q);
  clearAllHighlights();

  for(const [key, f] of Object.entries(frames)){
    const doc = f.doc;
    if(!doc) continue;

    const anchors = $$('a[href*="hotmart.com/pt-br/club/aulasdeceramica/community/"]', doc)
      .filter(a => HOTMART_RE.test(a.href));

    const seen = new Set();
    for(const a of anchors){
      const container = a.closest('td, div, p, article, section, tr') || a.parentElement;
      if(!container) continue;

      const rawText = container.innerText.replace(/\s+/g,' ').trim();
      if(!reWord.test(rawText)) continue;

      const idKey = container.outerHTML.slice(0,80) + '|' + a.href;
      if(seen.has(idKey)) continue;
      seen.add(idKey);

      hits.push({ source:f.name, link:a.href, text:rawText, node:container, frameKey:key });
    }
  }

  if(hits.length === 0){ showMessage("Nada encontrado."); return; }

  hitIndex = 0;
  renderCurrentHit(q);
  $('#live').textContent = `${hits.length} resultado(s) encontrado(s)`;
}

function clearAllHighlights(){
  Object.values(frames).forEach(f=>{
    try{ if(!f.doc) return; $$('.__hit-outline', f.doc).forEach(n=>n.classList.remove('__hit-outline')); }catch(e){}
  });
}

function renderCurrentHit(word){
  if(hitIndex < 0 || hitIndex >= hits.length) return;

  clearAllHighlights();
  const h = hits[hitIndex];

  $('#resultContent').innerHTML =
    `<div style="font-size:14px; opacity:.75; margin-bottom:4px">${escapeHTML(h.source)}</div>
     <div style="font-size:16px">${snippetAround(h.text, word)}</div>
     <div style="margin-top:6px">
       <a href="${h.link}" target="_blank" rel="noopener noreferrer">${h.link}</a>
     </div>`;
  $('#resultSource').textContent = "Navegue pelos resultados e clique no link para acessar.";
  $('#resultCounter').textContent = `${hitIndex+1} / ${hits.length}`;

  const f = frames[h.frameKey];
  try{
    if(f && f.doc && h.node){
      h.node.classList.add('__hit-outline');
      h.node.scrollIntoView({behavior:'smooth', block:'center', inline:'nearest'});
    }
  }catch(e){}
}

function showMessage(msg){
  $('#resultContent').innerHTML = `<em>${escapeHTML(msg)}</em>`;
  $('#resultSource').textContent = '';
  $('#resultCounter').textContent = '';
}

/* ========================= EVENTOS ========================= */
$('#searchForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  runSearch($('#q').value);
});
$('#prevBtn').addEventListener('click', ()=>{
  if(hits.length===0) return;
  hitIndex = (hitIndex - 1 + hits.length) % hits.length;
  renderCurrentHit($('#q').value.trim());
});
$('#nextBtn').addEventListener('click', ()=>{
  if(hits.length===0) return;
  hitIndex = (hitIndex + 1) % hits.length;
  renderCurrentHit($('#q').value.trim());
});
window.addEventListener('load', ()=>{ $('#q').focus(); });

/* ====== IMPORTANTE ======
Hospede este arquivo também em https://cesarabarbosa.github.io/
para que o navegador permita ler o conteúdo dos iframes (mesma origem).
========================= */
</script>
</body>
</html>
